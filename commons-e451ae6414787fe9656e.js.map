{"version":3,"sources":["webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/idb/build/idb.js","webpack:///(webpack)/buildin/global.js"],"names":["_a","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","error","code","includes","getInstallationsEndpoint","INSTALLATIONS_API_URL","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","responseExpiresIn","Number","replace","creationTime","Date","now","getErrorFromResponse","requestName","this","responseJson","errorData","label","json","sent","create","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","INTERNAL_AUTH_VERSION","getAuthorizationHeader","retryIfServerError","fn","result","createInstallationRequest","fid","endpoint","body","request","responseValue","_b","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","Promise","resolve","setTimeout","VALID_FID_PATTERN","generateFid","fidByteArray","Uint8Array","self","crypto","msCrypto","getRandomValues","array","btoa","String","fromCharCode","apply","substr","encode","test","getKey","appName","fidChangeCallbacks","Map","fidChanged","key","callFidChangeCallbacks","channel","getBroadcastChannel","postMessage","closeBroadcastChannel","broadcastFidChange","e_1","callbacks","get","callbacks_1","callbacks_1_1","next","done","callback","value","e_1_1","return","call","broadcastChannel","BroadcastChannel","onmessage","e","data","size","close","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","set","db","tx","objectStore","oldValue","transaction","put","complete","remove","delete","update","updateFn","store","newValue","undefined","getInstallationEntry","registrationPromise","installationEntry","oldEntry","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registeredInstallationEntry","trys","push","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","entry","updateInstallationRequest","generateAuthTokenRequest","platformLoggerProvider","platformLogger","getGenerateAuthTokenEndpoint","getImmediate","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","_onIdChange","callbackSet","Set","add","addCallback","removeCallback","getMissingValueError","valueName","registerInstallations","instance","INTERNAL","registerComponent","container","app","getProvider","options","name","configKeys_1","configKeys_1_1","keyName","extractAppConfig","getId","catch","console","_getId","getToken","_getToken","deleteInstallation","onIdChange","registerVersion","exports","toArray","arr","Array","prototype","slice","promisifyRequest","onsuccess","onerror","promisifyRequestCall","obj","args","p","then","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","Index","index","_index","cursor","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","length","nativeObject","getAll","query","count","items","iterateCursor","continue","openDb","version","upgradeCallback","indexedDB","onupgradeneeded","event","deleteDb","factory","g","Function","window","module"],"mappings":"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","file":"commons-e451ae6414787fe9656e.js","sourcesContent":["import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\nvar name = \"@firebase/installations\";\nvar version = \"0.4.17\";\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\n\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\"\n/* NOT_REGISTERED */\n] = 'Firebase Installation is not registered.', _a[\"installation-not-found\"\n/* INSTALLATION_NOT_FOUND */\n] = 'Firebase Installation not found.', _a[\"request-failed\"\n/* REQUEST_FAILED */\n] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\"\n/* APP_OFFLINE */\n] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\"\n/* DELETE_PENDING_REGISTRATION */\n] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\n\nfunction isServerError(error) {\n  return error instanceof FirebaseError && error.code.includes(\"request-failed\"\n  /* REQUEST_FAILED */\n  );\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\n\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2\n    /* COMPLETED */\n    ,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\n\nfunction getErrorFromResponse(requestName, response) {\n  return __awaiter(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2\n          /*return*/\n          , ERROR_FACTORY.create(\"request-failed\"\n          /* REQUEST_FAILED */\n          , {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\n\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\n\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\n\n\nfunction retryIfServerError(fn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var result;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , fn()];\n\n        case 1:\n          result = _a.sent();\n\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2\n            /*return*/\n            , fn()];\n          }\n\n          return [2\n          /*return*/\n          , result];\n      }\n    });\n  });\n}\n\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\n\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction createInstallationRequest(appConfig, _a) {\n  var fid = _a.fid;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2\n            /* COMPLETED */\n            ,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2\n          /*return*/\n          , registeredInstallationEntry];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Create Installation', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\n\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray); // Replace the first 4 random bits with the constant FID header of 0b0111.\n\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\n\n\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray); // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n\n  return b64String.substr(0, 22);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a string key that can be used to identify the app. */\n\n\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar fidChangeCallbacks = new Map();\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\n\nfunction fidChanged(appConfig, fid) {\n  var key = getKey(appConfig);\n  callFidChangeCallbacks(key, fid);\n  broadcastFidChange(key, fid);\n}\n\nfunction addCallback(appConfig, callback) {\n  // Open the broadcast channel if it's not already open,\n  // to be able to listen to change events from other tabs.\n  getBroadcastChannel();\n  var key = getKey(appConfig);\n  var callbackSet = fidChangeCallbacks.get(key);\n\n  if (!callbackSet) {\n    callbackSet = new Set();\n    fidChangeCallbacks.set(key, callbackSet);\n  }\n\n  callbackSet.add(callback);\n}\n\nfunction removeCallback(appConfig, callback) {\n  var key = getKey(appConfig);\n  var callbackSet = fidChangeCallbacks.get(key);\n\n  if (!callbackSet) {\n    return;\n  }\n\n  callbackSet.delete(callback);\n\n  if (callbackSet.size === 0) {\n    fidChangeCallbacks.delete(key);\n  } // Close broadcast channel if there are no more callbacks.\n\n\n  closeBroadcastChannel();\n}\n\nfunction callFidChangeCallbacks(key, fid) {\n  var e_1, _a;\n\n  var callbacks = fidChangeCallbacks.get(key);\n\n  if (!callbacks) {\n    return;\n  }\n\n  try {\n    for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\n      var callback = callbacks_1_1.value;\n      callback(fid);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n}\n\nfunction broadcastFidChange(key, fid) {\n  var channel = getBroadcastChannel();\n\n  if (channel) {\n    channel.postMessage({\n      key: key,\n      fid: fid\n    });\n  }\n\n  closeBroadcastChannel();\n}\n\nvar broadcastChannel = null;\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\n\nfunction getBroadcastChannel() {\n  if (!broadcastChannel && 'BroadcastChannel' in self) {\n    broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\n\n    broadcastChannel.onmessage = function (e) {\n      callFidChangeCallbacks(e.data.key, e.data.fid);\n    };\n  }\n\n  return broadcastChannel;\n}\n\nfunction closeBroadcastChannel() {\n  if (fidChangeCallbacks.size === 0 && broadcastChannel) {\n    broadcastChannel.close();\n    broadcastChannel = null;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction set(appConfig, value) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, objectStore, oldValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          objectStore = tx.objectStore(OBJECT_STORE_NAME);\n          return [4\n          /*yield*/\n          , objectStore.get(key)];\n\n        case 2:\n          oldValue = _a.sent();\n          return [4\n          /*yield*/\n          , objectStore.put(value, key)];\n\n        case 3:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 4:\n          _a.sent();\n\n          if (!oldValue || oldValue.fid !== value.fid) {\n            fidChanged(appConfig, value.fid);\n          }\n\n          return [2\n          /*return*/\n          , value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction remove(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).delete(key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\n\n\nfunction update(appConfig, updateFn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4\n          /*yield*/\n          , store.get(key)];\n\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , store.delete(key)];\n\n        case 3:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          return [4\n          /*yield*/\n          , store.put(newValue, key)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 7:\n          _a.sent();\n\n          if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\n            fidChanged(appConfig, newValue.fid);\n          }\n\n          return [2\n          /*return*/\n          , newValue];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\n\n\nfunction getInstallationEntry(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry;\n\n    var _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3\n          /*break*/\n          , 3];\n          _a = {};\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2\n          /*return*/\n          , (_a.installationEntry = _b.sent(), _a)];\n\n        case 3:\n          return [2\n          /*return*/\n          , {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\n\n\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0\n    /* NOT_STARTED */\n\n  };\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\n\n\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0\n  /* NOT_STARTED */\n  ) {\n      if (!navigator.onLine) {\n        // Registration required but app is offline.\n        var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\"\n        /* APP_OFFLINE */\n        ));\n        return {\n          installationEntry: installationEntry,\n          registrationPromise: registrationPromiseWithError\n        };\n      } // Try registering. Change status to IN_PROGRESS.\n\n\n      var inProgressEntry = {\n        fid: installationEntry.fid,\n        registrationStatus: 1\n        /* IN_PROGRESS */\n        ,\n        registrationTime: Date.now()\n      };\n      var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n      return {\n        installationEntry: inProgressEntry,\n        registrationPromise: registrationPromise\n      };\n    } else if (installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  ) {\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: waitUntilFidRegistration(appConfig)\n      };\n    } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\n\n\nfunction registerInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n\n          return [4\n          /*yield*/\n          , createInstallationRequest(appConfig, installationEntry)];\n\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2\n          /*return*/\n          , set(appConfig, registeredInstallationEntry)];\n\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3\n          /*break*/\n          , 4]; // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4\n          /*yield*/\n          , set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0\n            /* NOT_STARTED */\n\n          })];\n\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          throw e_1;\n\n        case 7:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\n\n\nfunction waitUntilFidRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n\n        case 2:\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // createInstallation request still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 4:\n          entry = _b.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          if (!(entry.registrationStatus === 0\n          /* NOT_STARTED */\n          )) return [3\n            /*break*/\n            , 7];\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            return [2\n            /*return*/\n            , registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2\n            /*return*/\n            , installationEntry];\n          }\n\n        case 7:\n          return [2\n          /*return*/\n          , entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\"\n      /* INSTALLATION_NOT_FOUND */\n      );\n    }\n\n    return clearTimedOutRequest(oldEntry);\n  });\n}\n\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0\n      /* NOT_STARTED */\n\n    };\n  }\n\n  return entry;\n}\n\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction generateAuthTokenRequest(_a, installationEntry) {\n  var appConfig = _a.appConfig,\n      platformLoggerProvider = _a.platformLoggerProvider;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          platformLogger = platformLoggerProvider.getImmediate({\n            optional: true\n          });\n\n          if (platformLogger) {\n            headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n          }\n\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2\n          /*return*/\n          , completedAuthToken];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Generate Auth Token', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\n\n\nfunction refreshAuthToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(dependencies.appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\"\n              /* NOT_REGISTERED */\n              );\n            }\n\n            var oldAuthToken = oldEntry.authToken;\n\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1\n            /* IN_PROGRESS */\n            ) {\n                // There already is a token request in progress.\n                tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n                return oldEntry;\n              } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\"\n                /* APP_OFFLINE */\n                );\n              }\n\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , tokenPromise];\n\n        case 2:\n          _a = _b.sent();\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n\n        case 4:\n          authToken = _a;\n          return [2\n          /*return*/\n          , authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\n\n\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n\n        case 2:\n          if (!(entry.authToken.requestStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // generateAuthToken still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 4:\n          entry = _a.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          authToken = entry.authToken;\n\n          if (authToken.requestStatus === 0\n          /* NOT_STARTED */\n          ) {\n              // The request timed out or failed in a different call. Try again.\n              return [2\n              /*return*/\n              , refreshAuthToken(dependencies, forceRefresh)];\n            } else {\n            return [2\n            /*return*/\n            , authToken];\n          }\n\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\"\n      /* NOT_REGISTERED */\n      );\n    }\n\n    var oldAuthToken = oldEntry.authToken;\n\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return __assign(__assign({}, oldEntry), {\n        authToken: {\n          requestStatus: 0\n          /* NOT_STARTED */\n\n        }\n      });\n    }\n\n    return oldEntry;\n  });\n}\n\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n\n          return [4\n          /*yield*/\n          , generateAuthTokenRequest(dependencies, installationEntry)];\n\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , authToken];\n\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3\n          /*break*/\n          , 5]; // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(dependencies.appConfig)];\n\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 5:\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: {\n              requestStatus: 0\n              /* NOT_STARTED */\n\n            }\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 6:\n          _a.sent();\n\n          _a.label = 7;\n\n        case 7:\n          throw e_1;\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2\n  /* COMPLETED */\n  ;\n}\n\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2\n  /* COMPLETED */\n  && !isAuthTokenExpired(authToken);\n}\n\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\n\n\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1\n    /* IN_PROGRESS */\n    ,\n    requestTime: Date.now()\n  };\n  return __assign(__assign({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\n\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1\n  /* IN_PROGRESS */\n  && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getId(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(dependencies.appConfig)];\n\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            registrationPromise.catch(console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(dependencies).catch(console.error);\n          }\n\n          return [2\n          /*return*/\n          , installationEntry.fid];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , completeInstallationRegistration(dependencies.appConfig)];\n\n        case 1:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , refreshAuthToken(dependencies, forceRefresh)];\n\n        case 2:\n          authToken = _a.sent();\n          return [2\n          /*return*/\n          , authToken.token];\n      }\n    });\n  });\n}\n\nfunction completeInstallationRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3\n          /*break*/\n          , 3]; // A createInstallation request is in progress. Wait until it finishes.\n\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n\n          _a.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallationRequest(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Delete Installation', response)];\n\n        case 2:\n          throw _a.sent();\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallation(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = dependencies.appConfig;\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0\n            /* NOT_STARTED */\n            ) {\n                // Delete the unregistered entry without sending a deleteInstallation request.\n                return undefined;\n              }\n\n            return oldEntry;\n          })];\n\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3\n          /*break*/\n          , 6];\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 2]; // Can't delete while trying to register.\n\n          throw ERROR_FACTORY.create(\"delete-pending-registration\"\n          /* DELETE_PENDING_REGISTRATION */\n          );\n\n        case 2:\n          if (!(entry.registrationStatus === 2\n          /* COMPLETED */\n          )) return [3\n            /*break*/\n            , 6];\n          if (!!navigator.onLine) return [3\n          /*break*/\n          , 3];\n          throw ERROR_FACTORY.create(\"app-offline\"\n          /* APP_OFFLINE */\n          );\n\n        case 3:\n          return [4\n          /*yield*/\n          , deleteInstallationRequest(appConfig, entry)];\n\n        case 4:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\n\n\nfunction _onIdChange(_a, callback) {\n  var appConfig = _a.appConfig;\n  addCallback(appConfig, callback);\n  return function () {\n    removeCallback(appConfig, callback);\n  };\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n  instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\n    var app = container.getProvider('app').getImmediate(); // Throws if app isn't configured properly.\n\n    var appConfig = extractAppConfig(app);\n    var platformLoggerProvider = container.getProvider('platform-logger');\n    var dependencies = {\n      appConfig: appConfig,\n      platformLoggerProvider: platformLoggerProvider\n    };\n    var installations = {\n      app: app,\n      getId: function getId() {\n        return _getId(dependencies);\n      },\n      getToken: function getToken(forceRefresh) {\n        return _getToken(dependencies, forceRefresh);\n      },\n      delete: function _delete() {\n        return deleteInstallation(dependencies);\n      },\n      onIdChange: function onIdChange(callback) {\n        return _onIdChange(dependencies, callback);\n      }\n    };\n    return installations;\n  }, \"PUBLIC\"\n  /* PUBLIC */\n  ));\n  instance.registerVersion(name, version);\n}\n\nregisterInstallations(firebase);\nexport { registerInstallations };","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.idb = {}));\n})(this, function (exports) {\n  'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function get() {\n          return this[targetProp][prop];\n        },\n        set: function set(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', ['name', 'keyPath', 'multiEntry', 'unique']);\n  proxyRequestMethods(Index, '_index', IDBIndex, ['get', 'getKey', 'getAll', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, ['openCursor', 'openKeyCursor']);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', ['direction', 'key', 'primaryKey', 'value']);\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, ['update', 'delete']); // proxy 'next' methods\n\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', ['name', 'keyPath', 'indexNames', 'autoIncrement']);\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, ['put', 'add', 'delete', 'clear', 'get', 'getAll', 'getKey', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, ['openCursor', 'openKeyCursor']);\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, ['deleteIndex']);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', ['objectStoreNames', 'mode']);\n  proxyMethods(Transaction, '_tx', IDBTransaction, ['abort']);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, ['deleteObjectStore', 'close']);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(DB, '_db', IDBDatabase, ['close']); // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  }); // polyfill getAll\n\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function (db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n"],"sourceRoot":""}